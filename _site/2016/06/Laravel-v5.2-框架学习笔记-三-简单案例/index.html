<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Laravel v5.2 框架学习笔记（三）：简单案例</title>
  <meta name="description" content="求知，思考，高效生活">
  <meta name="author" content="孟凡泽">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Meng Fanze">
  <meta name="twitter:description" content="求知，思考，高效生活">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Meng Fanze">
  <meta property="og:description" content="求知，思考，高效生活">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/font-awesome-4.6.3/css/font-awesome.min.css">
  <link rel="canonical" href="http://iFanze.cn//2016/06/Laravel-v5.2-%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89-%E7%AE%80%E5%8D%95%E6%A1%88%E4%BE%8B/">
  <link rel="alternate" type="application/rss+xml" title="Meng Fanze" href="/feed.xml">

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?10581c22432798705ab269dd1ce9615c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Meng Fanze">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Meng Fanze</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">求知，思考，高效生活</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Meng Fanze blog" class="blog-button">主页</a></li>
              <li class="navigation__item"><a href="/tags" title="标签" class="blog-button">标签</a></li>
              <li class="navigation__item"><a href="/categories" title="分类" class="blog-button">分类</a></li>
              <li class="navigation__item"><a href="/about" title="关于我" class="blog-button">关于</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- QQ -->
              <li class="navigation__item">
                <a href="/about/#contact" title="QQ:919446762 微信:iFanze">
                  <i class="fa fa-qq" aria-hidden="true"></i>
                  <span class="label">QQ</span>
                </a>
              </li>
            

            
              <!-- 微博 -->
              <li class="navigation__item">
                <a href="http://weibo.com/ichen0201" title="新浪微博" target="_blank">
                  <i class="fa fa-weibo" aria-hidden="true"></i>
                  <span class="label">微博</span>
                </a>
              </li>
            

            
              <!-- 知乎 -->
              <li class="navigation__item">
                <a href="https://www.zhihu.com/people/iFanze" title="知乎" target="_blank">
                  <i class="fa" aria-hidden="true">知</i>
                  <span class="label">知乎</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/iFanze" title="iFanze on GitHub" target="_blank">
                  <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                  <span class="label">Github</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:iFanze@outlook.com" title="Email iFanze@outlook.com" target="_blank">
                  <i class="fa fa-envelope fa-fw" aria-hidden="true"></i>
                  <span class="label">E-mail</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                  <i class="fa fa-rss fa-fw" aria-hidden="true"></i>
                  <span class="label">RSS</span>
              </a>
            </li>
          
            <!-- About me 
            <li class="navigation__item">
              <a href="/about" title="About me">
                  <i class="fa fa-info fa-fw" aria-hidden="true"></i>
                  <span class="label">About me</span>
              </a>
            </li>
            -->
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="10 Jun 2016" class="post-meta__date date">10 Jun 2016</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#PHP">PHP</a> </span>
    </div>
    <h1 class="post-title">Laravel v5.2 框架学习笔记（三）：简单案例</h1>
  </header>

  <section class="post">
    <p>注：官网上的demo，实现了一个简单的、与数据库有交互的Task List。</p>

<h2 id="basic-task-list">教程：Basic Task List</h2>

<h3 id="section">新建工程</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>composer create-project laravel/laravel quickstart --prefer-dist
<span class="c"># 或</span>
laravel new quickstart
</code></pre>
</div>

<h3 id="section-1">克隆成品(可选)</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/laravel/quickstart-basic quickstart
<span class="nb">cd </span>quickstart
composer install
php artisan migrate
</code></pre>
</div>

<h3 id="section-2">准备数据库</h3>

<h4 id="database-migrations">Database Migrations</h4>

<ul>
  <li>使用数据库Migrations来定义数据库的结构和编辑。</li>
  <li>使用一下命令生成一个新的数据库Migration：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>php artisan make:migration create_tasks_table --create<span class="o">=</span>tasks
</code></pre>
</div>

<ul>
  <li>打开生成在<code class="highlighter-rouge">database/migrations</code>下的文件，增加一个string列：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>public function up()
{
   Schema::create('tasks', function (Blueprint $table) {
       $table-&gt;increments('id');
       $table-&gt;string('name');
       $table-&gt;timestamps();
   });
}
</code></pre>
</div>

<ul>
  <li>执行migrate：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>php artisan migrate
</code></pre>
</div>

<h4 id="eloquent">Eloquent模型</h4>

<p>这是Laravel默认的ORM(Object-relation mapper)。</p>

<ul>
  <li>使用以下命令为我们刚刚建立在<code class="highlighter-rouge">tasks</code>数据库中的<code class="highlighter-rouge">Task</code>模型进行模型生成，生成的<code class="highlighter-rouge">Task.php</code>位于<code class="highlighter-rouge">app</code>目录下：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>php artisan make:model Task
</code></pre>
</div>

<h3 id="section-3">路由</h3>

<ul>
  <li>默认全部定义在<code class="highlighter-rouge">app/Http/routes.php</code>中。</li>
  <li>这里我们需要三种路由：查看任务列表、添加任务、删除任务。</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>use App\Task;
use Illuminate\Http\Request;

Route::get('/', function () {
    return view('tasks');   //位于resources/views/tasks.blade.php
});

Route::post('/task', function (Request $request) {
    //
});

Route::delete('/task/{task}', function (Task $task) {
    //
});
</code></pre>
</div>

<h3 id="section-4">布局和视图</h3>

<ul>
  <li><code class="highlighter-rouge">.blade.php</code>代表使用Blade模板引擎。</li>
  <li>建立模板页<code class="highlighter-rouge">resources/views/layouts/app.blade.php</code>：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Laravel Quickstart - Basic<span class="nt">&lt;/title&gt;</span>

        <span class="c">&lt;!-- CSS And JavaScript --&gt;</span>
    <span class="nt">&lt;/head&gt;</span>

    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"navbar navbar-default"</span><span class="nt">&gt;</span>
                <span class="c">&lt;!-- Navbar Contents --&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        @yield('content')
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<ul>
  <li>建立视图页<code class="highlighter-rouge">tasks.blade.php</code>页：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>@extends('layouts.app')

@section('content')

    <span class="c">&lt;!-- Bootstrap Boilerplate... --&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Display Validation Errors --&gt;</span>
        @include('common.errors')

        <span class="c">&lt;!-- New Task Form --&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">""</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">class=</span><span class="s">"form-horizontal"</span><span class="nt">&gt;</span>
            

            <span class="c">&lt;!-- Task Name --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"task"</span> <span class="na">class=</span><span class="s">"col-sm-3 control-label"</span><span class="nt">&gt;</span>Task<span class="nt">&lt;/label&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-6"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">id=</span><span class="s">"task-name"</span> <span class="na">class=</span><span class="s">"form-control"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="c">&lt;!-- Add Task Button --&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-offset-3 col-sm-6"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"btn btn-default"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-plus"</span><span class="nt">&gt;&lt;/i&gt;</span> Add Task
                    <span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="c">&lt;!-- TODO: Current Tasks --&gt;</span>
@endsection
</code></pre>
</div>

<h3 id="section-5">添加任务</h3>

<h4 id="section-6">表单验证</h4>

<ul>
  <li>完成<code class="highlighter-rouge">Route::post</code>函数：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Route::post('/task', function (Request $request) {
    $validator = Validator::make($request-&gt;all(), [
        'name' =&gt; 'required|max:255',
    ]);

    if ($validator-&gt;fails()) {
        return redirect('/')
            -&gt;withInput()
            -&gt;withErrors($validator);
    }

    // Create The Task...
});
</code></pre>
</div>

<ul>
  <li>注意，错误的输入和错误信息会在重定向到<code class="highlighter-rouge">/</code>后放入到session，这样就可以保持用户的输入状态。</li>
  <li><code class="highlighter-rouge">withErrors($validator)</code>函数使得我们可以在view中通过<code class="highlighter-rouge">$errors</code>访问出错信息。<code class="highlighter-rouge">common.errors</code>被包含在了我们之前写的<code class="highlighter-rouge">tasks.blade.php</code>页面中：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">&lt;!-- resources/views/common/errors.blade.php --&gt;</span>

@if (count($errors) &gt; 0)
    <span class="c">&lt;!-- Form Error List --&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"alert alert-danger"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;strong&gt;</span>Whoops! Something went wrong!<span class="nt">&lt;/strong&gt;</span>

        <span class="nt">&lt;br&gt;&lt;br&gt;</span>

        <span class="nt">&lt;ul&gt;</span>
            @foreach ($errors-&gt;all() as $error)
                <span class="nt">&lt;li&gt;&lt;/li&gt;</span>
            @endforeach
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
@endif
</code></pre>
</div>

<h4 id="section-7">创建任务</h4>

<ul>
  <li>继续完善<code class="highlighter-rouge">Route::post</code>方法，保存正确的数据到数据库：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Route::post('/task', function (Request $request) {
    $validator = Validator::make($request-&gt;all(), [
        'name' =&gt; 'required|max:255',
    ]);

    if ($validator-&gt;fails()) {
        return redirect('/')
            -&gt;withInput()
            -&gt;withErrors($validator);
    }

    $task = new Task;
    $task-&gt;name = $request-&gt;name;
    $task-&gt;save();

    return redirect('/');
});
</code></pre>
</div>

<h4 id="section-8">查看所有任务</h4>

<ul>
  <li>编辑<code class="highlighter-rouge">/</code>路径：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Route::get('/', function () {
    $tasks = Task::orderBy('created_at', 'asc')-&gt;get();

    return view('tasks', [
        'tasks' =&gt; $tasks
    ]); //第二个参数：数组中每个key都可在视图模板中作为变量访问
});
</code></pre>
</div>

<ul>
  <li>编写<code class="highlighter-rouge">tasks.blade.php</code>：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>@extends('layouts.app')

@section('content')
    <span class="c">&lt;!-- Create Task Form... --&gt;</span>

    <span class="c">&lt;!-- Current Tasks --&gt;</span>
    @if (count($tasks) &gt; 0)
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel panel-default"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-heading"</span><span class="nt">&gt;</span>
                Current Tasks
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"panel-body"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table table-striped task-table"</span><span class="nt">&gt;</span>

                    <span class="c">&lt;!-- Table Headings --&gt;</span>
                    <span class="nt">&lt;thead&gt;</span>
                        <span class="nt">&lt;th&gt;</span>Task<span class="nt">&lt;/th&gt;</span>
                        <span class="nt">&lt;th&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;</span>
                    <span class="nt">&lt;/thead&gt;</span>

                    <span class="c">&lt;!-- Table Body --&gt;</span>
                    <span class="nt">&lt;tbody&gt;</span>
                        @foreach ($tasks as $task)
                            <span class="nt">&lt;tr&gt;</span>
                                <span class="c">&lt;!-- Task Name --&gt;</span>
                                <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">"table-text"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;div&gt;&lt;/div&gt;</span>
                                <span class="nt">&lt;/td&gt;</span>

                                <span class="nt">&lt;td&gt;</span>
                                    <span class="c">&lt;!-- TODO: Delete Button --&gt;</span>
                                <span class="nt">&lt;/td&gt;</span>
                            <span class="nt">&lt;/tr&gt;</span>
                        @endforeach
                    <span class="nt">&lt;/tbody&gt;</span>
                <span class="nt">&lt;/table&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    @endif
@endsection
</code></pre>
</div>

<h3 id="section-9">删除任务</h3>

<h4 id="section-10">添加删除按钮</h4>

<ul>
  <li>完成<code class="highlighter-rouge">tasks.blade.php</code>:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;tr&gt;
    &lt;!-- Task Name --&gt;
    &lt;td class="table-text"&gt;
        &lt;div&gt;&lt;/div&gt;
    &lt;/td&gt;

    &lt;!-- Delete Button --&gt;
    &lt;td&gt;
        &lt;form action="" method="POST"&gt;
            
            

            &lt;button type="submit" class="btn btn-danger"&gt;
                &lt;i class="fa fa-trash"&gt;&lt;/i&gt; Delete
            &lt;/button&gt;
        &lt;/form&gt;
    &lt;/td&gt;
&lt;/tr&gt;
</code></pre>
</div>

<ul>
  <li>注意，HTML表单的method只能是GET或者POST，所以这里不能用DELETE，而是用``生成<code class="highlighter-rouge">&lt;input type='hidden' name='_method' value='DELETE'</code>交给Laravel后台解析。</li>
</ul>

<h4 id="section-11">删除操作</h4>

<ul>
  <li>完成<code class="highlighter-rouge">/task/{task}</code>，这里使用了model binding的方式自动去除{task}作为形参，表示要删除的对象。</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Route::delete('/task/{task}', function (Task $task) {
    $task-&gt;delete();

    return redirect('/');
});
</code></pre>
</div>

<h2 id="section-12">问题解决</h2>

<h3 id="section-13">服务器无响应问题</h3>

<p>问题描述：访问 http://seckillphp.ifanze-local.cn/quickstart/public 提示服务器无响应。
问题解决：记得给<code class="highlighter-rouge">storage</code>和<code class="highlighter-rouge">bootstrap/cache</code>赋777权限。</p>

<h3 id="section-14">路由无效</h3>

<p>问题描述：访问除主页外的地址，如http://seckillphp.ifanze-local.cn/quickstart/public/task，均显示404错误。
问题解决：这个问题应该出现在第二次开启服务器之后，因为是apache的rewrite模块没有开启或者配置正确的问题：</p>

<ol>
  <li>在<code class="highlighter-rouge">httpd.conf</code>中取消下面一行前的注释：</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>LoadModule rewrite_module modules/mod_rewrite.so
</code></pre>
</div>

<ol>
  <li>配置<code class="highlighter-rouge">&lt;Directory&gt;</code>标签，使用：</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>AllowOverride all
</code></pre>
</div>

<h2 id="task-list">教程2：升级版的Task List</h2>

<p>与上一个项目相比，这个demo增加了用户登录和注册模块。这里只记录一些在这个教程中新学到的几项笔记。</p>

<ul>
  <li>
    <p>demo中，表单的URL是写死的，如<code class="highlighter-rouge">action='/task'</code>，这样对于我本机将网站根URL放在<code class="highlighter-rouge">http://seckillphp.ifanze-local.cn/quickstart/public</code>位置上是不正确的。可以根据上一个教程的写法更正：<code class="highlighter-rouge">action=""</code></p>
  </li>
  <li>
    <p>框架已经自带了登录相关的Model配置，使用数据库Migration时会创建表<code class="highlighter-rouge">users</code>和<code class="highlighter-rouge">password_resets</code>，以及<code class="highlighter-rouge">User</code>Model。</p>
  </li>
  <li>
    <p>使用<code class="highlighter-rouge">php artisan make:model Task</code>创建的Model会默认使用名称为其复数形式的表。在Model的定义中，使用<code class="highlighter-rouge">$fillable</code>属性指定使用”mass-assignable”的列，如：</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>class Task extends Model
{
    protected $fillable = ['name'];
}
</code></pre>
</div>

<ul>
  <li>为了表示user和tasks之间的一对多关系。需要在两个模型中进行相应的定义：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>class User extends Authenticatable
{
    /**
     * Get all of the tasks for the user.
     */
    public function tasks()
    {
        return $this-&gt;hasMany(Task::class);
    }
}

class Task extends Model
{
    /**
     * Get the user that owns the task.
     */
    public function user()
    {
        return $this-&gt;belongsTo(User::class);
    }
}
</code></pre>
</div>

<ul>
  <li>让Laravel自动生成登录注册相关的视图和路由，使用以下命令：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>php artisan make:auth
</code></pre>
</div>
<p>然后在<code class="highlighter-rouge">routes.php</code>中调用<code class="highlighter-rouge">Route::auth()</code>。
然后在<code class="highlighter-rouge">AuthController.php</code>文件中配置：<code class="highlighter-rouge">protected $redirectTo = '/tasks';</code>
然后在<code class="highlighter-rouge">Http/Middleware/RedirectIfAuthenticated.php</code>中配置：<code class="highlighter-rouge">return redirect('/tasks');</code></p>

<ul>
  <li>创建Controller的指令：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>php artisan make:controller TaskController
</code></pre>
</div>

<ul>
  <li>配置路由指向Controller中的Method：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>Route::get('/tasks', 'TaskController@index');
Route::post('/task', 'TaskController@store');
Route::delete('/task/{task}', 'TaskController@destroy');
</code></pre>
</div>

<ul>
  <li>使用middleware来保证用户必须登录才能进入主页面：在controller的构造函数中，调用相应的middleware（所有可用的路由middleware在<code class="highlighter-rouge">app/Http/Kernel.php</code>中定义）：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>public function __construct()
{
   $this-&gt;middleware('auth');
}
</code></pre>
</div>

<ul>
  <li>
    <p>如果视图是按照文件夹分组的：<code class="highlighter-rouge">return view('tasks.index');</code></p>
  </li>
  <li>
    <p>创建Task，这里的<code class="highlighter-rouge">user()</code>可以自动设置新记录的<code class="highlighter-rouge">user_id</code>值为当前登录用户的id。</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>public function store(Request $request)
{
    $this-&gt;validate($request, [
        'name' =&gt; 'required|max:255',
    ]);

    $request-&gt;user()-&gt;tasks()-&gt;create([
        'name' =&gt; $request-&gt;name,
    ]);

    return redirect('/tasks');
}
</code></pre>
</div>

<p>php</p>

<p>mb’ge</p>


  </section>
  
</article>


<!--
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//ifanze.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
-->
<!--高速版-->
<div id="SOHUCS"></div>
<script charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
  window.changyan.api.config({
    appid: 'cysp5sdDS',
    conf: 'prod_d82562f88560b08461d2ee27cc031105'
  });
</script>        

      </div>

      <footer class="footer">
  <span class="footer__copyright">Copyright &copy; 2016 孟凡泽. All Rights Reserved. 皖ICP备16011114号-1<br/><br/>Powered by Jekyll. <br/><br/>Theme: Jekyll-Uno by Josh Gerdes</span>
</footer> 

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    </div>
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=56525424" charset="UTF-8"></script>
  </body>
</html>
