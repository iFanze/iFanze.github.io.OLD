<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Mac搭建PHP开发环境</title>
  <meta name="description" content="求知，思考，高效生活">
  <meta name="author" content="孟凡泽">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Meng Fanze">
  <meta name="twitter:description" content="求知，思考，高效生活">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Meng Fanze">
  <meta property="og:description" content="求知，思考，高效生活">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/font-awesome-4.6.3/css/font-awesome.min.css">
  <link rel="canonical" href="http://iFanze.cn//2016/05/Mac%E6%90%AD%E5%BB%BAPHP%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">
  <link rel="alternate" type="application/rss+xml" title="Meng Fanze" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Meng Fanze">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Meng Fanze</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">求知，思考，高效生活</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Meng Fanze blog" class="blog-button">主页</a></li>
              <li class="navigation__item"><a href="/tags" title="标签" class="blog-button">标签</a></li>
              <li class="navigation__item"><a href="/categories" title="分类" class="blog-button">分类</a></li>
              <li class="navigation__item"><a href="/about" title="关于我" class="blog-button">关于</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- QQ -->
              <li class="navigation__item">
                <a href="http://fanze.qzone.qq.com" title="QQ:919446762 微信:iFanze" target="_blank">
                  <i class="fa fa-qq" aria-hidden="true"></i>
                  <span class="label">QQ</span>
                </a>
              </li>
            

            
              <!-- 微博 -->
              <li class="navigation__item">
                <a href="http://weibo.com/ichen0201" title="新浪微博" target="_blank">
                  <i class="fa fa-weibo" aria-hidden="true"></i>
                  <span class="label">微博</span>
                </a>
              </li>
            

            
              <!-- 知乎 -->
              <li class="navigation__item">
                <a href="https://www.zhihu.com/people/iFanze" title="知乎" target="_blank">
                  <i class="fa" aria-hidden="true">知</i>
                  <span class="label">知乎</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/iFanze" title="iFanze on GitHub" target="_blank">
                  <i class="fa fa-github fa-lg" aria-hidden="true"></i>
                  <span class="label">Github</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:iFanze@outlook.com" title="Email iFanze@outlook.com" target="_blank">
                  <i class="fa fa-envelope fa-fw" aria-hidden="true"></i>
                  <span class="label">E-mail</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                  <i class="fa fa-rss fa-fw" aria-hidden="true"></i>
                  <span class="label">RSS</span>
              </a>
            </li>
          
            <!-- About me 
            <li class="navigation__item">
              <a href="/about" title="About me">
                  <i class="fa fa-info fa-fw" aria-hidden="true"></i>
                  <span class="label">About me</span>
              </a>
            </li>
            -->
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="24 May 2016" class="post-meta__date date">24 May 2016</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Mac">Mac</a> <a href="/tags/#Apache">Apache</a> <a href="/tags/#MySQL">MySQL</a> <a href="/tags/#PHP">PHP</a> </span>
    </div>
    <h1 class="post-title">Mac搭建PHP开发环境</h1>
  </header>

  <section class="post">
    <p>注：之前做PHP的项目都是在Windows使用XAMPP一站式搞定Apache + MySQL + PHP的环境问题，这次我想要在OS X上用PHP实现下之前提到的秒杀系统，首先就需要体验一下在Unix/Linux环境中配置环境的过程。虽然任务不艰难但还是有些地方困扰到了我的，所以做一篇总结。</p>

<h2 id="section">方案选择</h2>

<p>在Mac上搭建相关开发环境的方式网上有太多了，我总结了下，按照配置过程由简单到复杂、配置灵活性由小到大的顺序大致可以总结为：</p>

<ol>
  <li>使用系统自带Apache和PHP。Mac OS X已经整合了这两个，自然是最简单的，好像只要在httpd.conf里启用php相关的模块就可以直接使用了。但是系统里并没有整合MySQL。并且，看知乎上大家说会有一些问题，比如系统升级丢失模块配置等等。简单玩了玩就放弃了这种方案。</li>
  <li>使用Xampp等GUI整合安装包。这个和Windows完全一样的感觉，没意思，用Unix/Linux就是要用CLI嘛。</li>
  <li>使用Homebrew等包管理工具进行安装。这是我最后采用的方法。配置复杂度和灵活性都介于上下两种方案之间。</li>
  <li>直接下载、编译和使用源码包。虽说这是使用开源软件最通用的方式，但是对于Apache这种感觉很牛的软件，这一次我不想太关注细节，万一出现编译错误或者一些不懂的细枝末节就有些浪费时间了。</li>
</ol>

<p>现在开始吧~</p>

<h2 id="homebrew">Homebrew的基本使用</h2>

<p>Homebrew在Mac平台上也算是鼎鼎大名的软件了，自己老早就安装并且研究过。把常用的命令整理如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew update                               //更新源
brew search  xxx                          //搜索包
brew install xxx                          //安装包
brew list                                 //已安装列表
brew uninstall xxx                        //卸载包
brew upgrade xxx                          //升级包
brew tap xxx                              //添加仓库
brew services list                        //已安装brew服务的状态
brew services start/stop/restart httpd24  //启动、停止、重启Apache
</code></pre>
</div>

<h2 id="apache">Apache的安装</h2>

<p>Apache并没有在homebrew的默认仓库中，要使用<code class="highlighter-rouge">brew tap homebrew/apache</code>来添加相应的仓库，或者直接运行以下命令进行安装，这里选择的是2.4版本：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install homebrew/apache/httpd24
</code></pre>
</div>

<p>根据Homebrew的规则，默认安装到<code class="highlighter-rouge">/usr/local</code>目录下。二进制文件、配置文件、日志文件等都存放在其下的各子目录中。</p>

<h2 id="apache-1">Apache的配置和虚拟主机</h2>

<ul>
  <li>
    <p><strong>修改监听端口。</strong>Apache默认监听8080端口，通过修改<code class="highlighter-rouge">/usr/local/etc/apache2/2.4/httpd.conf</code>中的下面一行更改至80端口。</p>

    <p><code class="highlighter-rouge">
  Listen 80
 </code></p>
  </li>
  <li>
    <p><strong>配置虚拟主机。</strong>可以发现，默认服务器根目录是在<code class="highlighter-rouge">/usr/local/var/www/htdocs</code>目录下。我习惯将自己放在Github上的源代码全放在自己的Home下，又不想更改这个默认配置。所以我选择配置开启虚拟主机模块。取消掉这一行的注释即可：</p>

    <p><code class="highlighter-rouge">
  Include /usr/local/etc/apache2/2.4/extra/httpd-vhosts.conf
 </code></p>

    <p>然后编辑<code class="highlighter-rouge">httpd-vhosts.conf</code>这个文件：</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;VirtualHost *:80&gt;
ServerAdmin ifanze-local@outlook.com
DocumentRoot "/Users/Fanze/Github/SeckillPHP"
ServerName seckillphp.ifanze-local.cn
ErrorLog "/usr/local/var/log/apache2/seckillphp.ifanze-local.cn-error_log"
CustomLog "/usr/local/var/log/apache2/seckillphp.ifanze-local.cn-access_log" common
&lt;Directory "/Users/Fanze/Github/SeckillPHP/"&gt;
Options FollowSymLinks Indexes MultiViews
AllowOverride None
Require all granted
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>
</div>

<p>几点说明：</p>

<ul>
  <li>这里我使用了<code class="highlighter-rouge">seckillphp.ifanze-local.cn</code>作为ServerName，所以要修改host文件，要将它指向<code class="highlighter-rouge">127.0.0.1</code>。</li>
  <li>
    <p>需要Directory一段，无论是写在这个文件里还是在httpd.conf里。否则会遇到没权限访问的问题。其中的含义网上很容易找到，但需要注意，apache 2.4不同于旧版，使用<code class="highlighter-rouge">Require all granted</code>替代了之前要写的<code class="highlighter-rouge">Order deny,allow</code>等配置访问权限。</p>
  </li>
  <li>
    <p><strong>控制Apache服务的开关。</strong>注意到使用<code class="highlighter-rouge">which apachectl</code>可以查看到apachectl已经从系统自带的apache路径自动改到了我们刚刚安装apache的路径下，所以可以直接使用以下命令控制apache开关：</p>

    <p><code class="highlighter-rouge">
  sudo apachectl start
  sudo apachectl stop
 </code>
 此外，同样自动为我们做好的还包括使用brew services：</p>

    <p><code class="highlighter-rouge">
  sudo brew services start httpd24
  sudo brew services stop httpd24
 </code></p>

    <p>效果是相同的。</p>
  </li>
</ul>

<h2 id="php">PHP的安装</h2>

<p>之前在Windows上使用的PHP版本是5.5或者5.6，取决于要连接的Oracle数据库是11g还是12c。截止到今天（2016年5月24日），PHP7已经正式发布并且最新版本已经到7.0.6了。看慕课网上的视频了解到PHP7主要的改进包括<strong>性能提升</strong>和<strong>变量类型</strong>。（艾玛这还是我认识的那个声明变量从来不用声明类型的PHP吗？）既然这次是自己自发进行的一次练习，就果断选择最新的版本用上吧！</p>

<p>和apache一样，php也不在默认仓库中：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>brew install homebrew/php/php70
</code></pre>
</div>

<p>安装路径也默认和apache相似，不过安装完成后，如果直接执行<code class="highlighter-rouge">php -v</code>会发现还是系统自带的php。</p>

<h2 id="apachephp">Apache配置PHP模块</h2>

<p>PHP的安装路径下包括了供apache使用的<code class="highlighter-rouge">libphp7.so</code>模块。只需要配置httpd.conf文件，新增配置：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>LoadModule php7_module /usr/local/Cellar/php70/7.0.6/libexec/apache2/libphp7.so

&lt;FilesMatch .php$&gt;
    SetHandler application/x-httpd-php
&lt;/FilesMatch&gt;
</code></pre>
</div>

<p>其中，FilesMatch部分也能够顾名思义。还有一处设置默认文档的地方也要增加一项<code class="highlighter-rouge">index.php</code>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;IfModule dir_module&gt;
    DirectoryIndex index.html index.php
&lt;/IfModule&gt;
</code></pre>
</div>

<p>重启Apache。</p>

<h2 id="apachephp-1">测试Apache+PHP</h2>

<p>在虚拟主机的根目录下建立<code class="highlighter-rouge">index.php</code>，输出<code class="highlighter-rouge">phpinfo()</code>，浏览器中打开Hostname就能看到预示着配置成功的页面了~</p>

<h2 id="mysql">安装MySQL</h2>

<p>安装SQL走了一些弯路，刚开始也想用Homebrew来安装，但是安装完成后无法找到默认的Root密码（5.9之前的版本是没有密码的。），官方的文档上这一块也没有较明确的说明，只是推荐下载dwg包进行安装。所以最后就是用的这个方法，下载安装都很快。并且将MySQL的开关集成在了系统偏好设置里。可能因为我用各种方法装了删、删了又装好多次，最后一遍安装完毕后重启了下电脑才正常启动MySQL服务的。</p>

<p>默认密码在安装完成后会弹窗提示，也会保留在OS X的通知栏里，建议截图保存并及时修改。</p>

<p>这里记录一下卸载MySQL的步骤：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo rm /usr/local/mysql
sudo rm -rf /usr/local/mysql*
sudo rm -rf /Library/StartupItems/MySQLCOM
sudo rm -rf /Library/PreferencePanes/My*
sudo vim /etc/hostconfig and removed the line MYSQLCOM=-YES-
rm -rf ~/Library/PreferencePanes/My*
sudo rm -rf /Library/Receipts/mysql*
sudo rm -rf /Library/Receipts/MySQL*
sudo rm -rf /var/db/receipts/com.mysql.*
</code></pre>
</div>

<h2 id="mysql-1">配置MySQL</h2>

<ul>
  <li>
    <p>将<code class="highlighter-rouge">/usr/local/mysql/bin</code>添加到环境变量PATH。我使用zsh，所以修改<code class="highlighter-rouge">~/.zshrc</code>文件。</p>
  </li>
  <li>
    <p>修改root用户的默认密码。执行下面命令即可，先输入旧密码，再输入两遍新密码。</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>mysqladmin -u root -p password
</code></pre>
</div>

<ul>
  <li>登录mysql。执行下面的命令，输入新密码，成功就表示MySQL配置成功：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>mysql -u root -p
</code></pre>
</div>

<p>然后就可以使用Navicat Premium等软件对数据库进行管理了。以后有空的时候再装个phpmyadmin吧。</p>

<h2 id="php-1">配置PHP</h2>

<ul>
  <li>PHP的配置文件在<code class="highlighter-rouge">/usr/local/etc/php/7.0</code>目录下，从默认配置拷贝一份：</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo cp /etc/php.ini.default /etc/php.ini
</code></pre>
</div>

<ul>
  <li>至于PHP连接mysql的方式（mysql、mysqli、pdo），就根据需求来吧。在<code class="highlighter-rouge">php.ini</code>中开启相应的模块就行。</li>
</ul>


  </section>
  
</article>


<!--
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//ifanze.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
-->
<!--高速版-->
<div id="SOHUCS"></div>
<script charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
  window.changyan.api.config({
    appid: 'cysp5sdDS',
    conf: 'prod_d82562f88560b08461d2ee27cc031105'
  });
</script>        

      </div>

      <footer class="footer">
  <span class="footer__copyright">Copyright &copy; 孟凡泽 2016<br/><br/>Theme: Jekyll-Uno by Josh Gerdes</span>
</footer> 

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>


    </div>
  </body>
</html>